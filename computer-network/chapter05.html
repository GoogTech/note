<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.25">
    <link rel="icon" href="icon/favicon.ico"><meta name="author" content="GoogTech"><meta name="keywords" content="GoogTech, 408, CS Course Learning Note, https://goog.tech/note"><title>传输层 | GoogTech</title><meta name="description" content="GoogTech — CS Course Learning Note">
    <link rel="preload" href="/note/assets/js/runtime~app.cc6e98cd.js" as="script"><link rel="preload" href="/note/assets/css/styles.45c8bbeb.css" as="style"><link rel="preload" href="/note/assets/js/873.a7dae0f7.js" as="script"><link rel="preload" href="/note/assets/js/app.2efb65c3.js" as="script">
    <link rel="stylesheet" href="/note/assets/css/styles.45c8bbeb.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/note/" class=""><img class="logo" src="/note/icon/apple-touch-icon.png" alt="GoogTech"><span class="site-name can-hide">GoogTech</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="408课程"><span class="title">408课程</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="408课程"><span class="title">408课程</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/note/operating-system/README.md" class="nav-link" aria-label="操作系统"><!--[--><!--]--> 操作系统 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/note/data-structure/README.md" class="nav-link" aria-label="数据结构"><!--[--><!--]--> 数据结构 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/note/computer-network/README.md" class="nav-link" aria-label="计算机网络"><!--[--><!--]--> 计算机网络 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/note/computer-compose-principle" class="nav-link" aria-label="计算机组成原理"><!--[--><!--]--> 计算机组成原理 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/googtech/note" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="408课程"><span class="title">408课程</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="408课程"><span class="title">408课程</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/note/operating-system/README.md" class="nav-link" aria-label="操作系统"><!--[--><!--]--> 操作系统 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/note/data-structure/README.md" class="nav-link" aria-label="数据结构"><!--[--><!--]--> 数据结构 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/note/computer-network/README.md" class="nav-link" aria-label="计算机网络"><!--[--><!--]--> 计算机网络 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/note/computer-compose-principle" class="nav-link" aria-label="计算机组成原理"><!--[--><!--]--> 计算机组成原理 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/googtech/note" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item active">介绍</p><ul class=""><li><!--[--><a href="/note/computer-network/" class="nav-link router-link-active sidebar-item" aria-label="计算机网络"><!--[--><!--]--> 计算机网络 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/note/computer-network/chapter01.html" class="nav-link sidebar-item" aria-label="体系结构"><!--[--><!--]--> 体系结构 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/note/computer-network/chapter02.html" class="nav-link sidebar-item" aria-label="物理层"><!--[--><!--]--> 物理层 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/note/computer-network/chapter03.html" class="nav-link sidebar-item" aria-label="链路层"><!--[--><!--]--> 链路层 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/note/computer-network/chapter04.html" class="nav-link sidebar-item" aria-label="网络层"><!--[--><!--]--> 网络层 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/note/computer-network/chapter05.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="传输层"><!--[--><!--]--> 传输层 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/note/computer-network/chapter05.html#功能" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="功能"><!--[--><!--]--> 功能 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/note/computer-network/chapter05.html#端口" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="端口"><!--[--><!--]--> 端口 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/note/computer-network/chapter05.html#udp" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="UDP"><!--[--><!--]--> UDP <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/note/computer-network/chapter05.html#tcp" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="TCP"><!--[--><!--]--> TCP <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/note/computer-network/chapter06.html" class="nav-link sidebar-item" aria-label="应用层"><!--[--><!--]--> 应用层 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="传输层" tabindex="-1"><a class="header-anchor" href="#传输层" aria-hidden="true">#</a> 传输层</h1><h3 id="功能" tabindex="-1"><a class="header-anchor" href="#功能" aria-hidden="true">#</a> 功能</h3><ul><li><ol><li>提供应用进程之间端到端之间的逻辑通信</li></ol></li><li><ol start="2"><li>复用和分用</li></ol></li><li><ol start="3"><li>对收到的报文进行差错检测</li></ol></li><li><ol start="4"><li>提供两种不同的传输协议（UDP、TCP）</li></ol></li></ul><h3 id="端口" tabindex="-1"><a class="header-anchor" href="#端口" aria-hidden="true">#</a> 端口</h3><ul><li><p>端口号长度为 16 bit，故可表示 65535 个不同的端口</p></li><li><p>分类</p><ul><li><p>服务器端</p><ul><li>熟知端口号：派给TCP/IP最重要的一些应用程序，范围为 0 ~ 1023</li><li>登记端口号：供给没有熟知端口号的应用程序，范围为 1024 ~ 49151</li></ul></li><li><p>客户端</p><ul><li>临时端口号：仅在客户端运行时才动态地选择，范围为 49152 ~ 65535</li></ul></li></ul></li><li><p>扩展</p><ul><li>数据链路层的SAP是MAC地址</li><li>传输层的SAP是端口地址</li><li>网络层的SAP是IP地址</li></ul></li></ul><h3 id="udp" tabindex="-1"><a class="header-anchor" href="#udp" aria-hidden="true">#</a> UDP</h3><ul><li><p>在IP的数据报服务之上仅增加：复用和分用、差错检测</p></li><li><p>特点</p><ul><li><ol><li>无连接，减少开销和发送数据之前的延迟</li></ol></li><li><ol start="2"><li>面向报文，适合一次性传输少量数据的网络应用</li></ol></li><li><ol start="3"><li>最大努力交付，即不保证可靠交付</li></ol></li><li><ol start="4"><li>无阻塞控制，使用很多实时应用</li></ol></li><li><ol start="5"><li>首部开销小，仅 8 B</li></ol></li></ul></li><li><p>数据报</p><ul><li>由UDP首部和用户数据组成</li><li>首部格式：源端口、目的端口、长度、校验和（各 2 B）</li></ul></li><li><p>校验</p><ul><li>通过校验和检查首部和数据部分</li><li>伪首部既不向下传送又不向上递交，也不计入长度，仅为了计算校验和</li></ul></li></ul><h3 id="tcp" tabindex="-1"><a class="header-anchor" href="#tcp" aria-hidden="true">#</a> TCP</h3><ul><li><p>是在不可靠传输的IP层之上实现的可靠的数据传输协议</p></li><li><p>特点</p><ul><li><ol><li>面向连接、字节流</li></ol></li><li><ol start="2"><li>提供全双工通信</li></ol></li><li><ol start="3"><li>一对一，即点对点</li></ol></li><li><ol start="4"><li>提供可靠的交付服务</li></ol></li></ul></li><li><p>报文段</p><ul><li><p>由首部和数据两部分组成</p></li><li><p>首部前 20B 是固定的，其长度为 4B 的整数倍</p></li><li><p>TCP报文段示例图</p><ul><li></li></ul></li></ul></li><li><p>连接管理</p><ul><li><p>建立（三次握手）</p><ul><li><ol><li>SYN = 1, seq = x</li></ol></li><li><ol start="2"><li>SYN = 1, ACK = 1, seq = y, ack = x + 1</li></ol></li><li><ol start="3"><li>ACK = 1, seq = x + 1, ack = y + 1</li></ol></li><li><p>三次握手示例图</p><ul><li></li></ul></li></ul></li><li><p>释放（四次握手）</p><ul><li><ol><li>FIN = 1, seq = u</li></ol></li><li><ol start="2"><li>ACK = 1, seq = v, ack = u + 1</li></ol></li><li><ol start="3"><li>FIN = 1, ACK = 1, seq = w, ack = u + 1</li></ol></li><li><ol start="4"><li>ACK = 1, seq = u + 1, ack = w + 1</li></ol></li><li><p>四次握手示例图</p><ul><li></li></ul></li></ul></li></ul></li><li><p>可靠传输</p><ul><li><p>校验机制（与UDP相同）</p></li><li><p>序号机制</p><ul><li>序号字段 seq 的值是指本报文段所发送的数据的第一个字节的序号</li></ul></li><li><p>确认机制</p><ul><li>确认号 ack 是指期望收到对方下一个报文段的数据的第一个字节的序号</li><li>默认采用累计确认，即TCP只确认数据流中至第一个丢失字节为止的字节</li></ul></li><li><p>重传机制</p><ul><li>超时：当计时器设置的重传时间到期但还未收到确认时，需重传这一报文段</li><li>冗余ACK：当发送发收到对同一报文段的3个冗余ACK时，即代表被确认报文段之后的报文已丢失，需立即重传（快速重传）</li></ul></li></ul></li><li><p>流量控制</p><ul><li><p>传输层定义端到端用户之间的流量控制</p></li><li><p>数据链路层定义两个中间的相邻结点的流量控制</p></li><li><p>接收窗口（rwnd）</p><ul><li>根据自己接收缓存的大小，动态地调整发送方的发送窗口的大小</li></ul></li><li><p>拥塞窗口（cwnd）</p><ul><li>根据当前网络拥塞程度的估计而确定的窗口值</li></ul></li></ul></li><li><p>拥塞控制</p><ul><li><p>接收窗口（rwnd）</p><ul><li>接收方根据目前接收缓存大小所许诺的最新窗口值，反映接收方的容量</li></ul></li><li><p>拥塞窗口（cwnd）</p><ul><li>发送发根据自己估算的网络拥塞程度而设置的窗口值，反映网络当前容量</li></ul></li><li><p>发送窗口的上限值 = min{ 接收窗口，拥塞窗口 }</p></li><li><p>慢开始和拥塞避免算法</p><ul><li><p>在TCP连接建立和网络出现超时时，采用慢开始和拥塞避免算法</p></li><li><p>慢开始</p><ul><li>每经过一次传播轮次，cwnd就会加倍（x2），其大小呈指数式增长</li></ul></li><li><p>拥塞避免算法</p><ul><li>每经过一个往返时延RTT，cwnd就会加1，其大小呈线性规律增长</li></ul></li><li><p>慢开始和拥塞避免算法的实现过程示例图</p><ul><li></li></ul></li></ul></li><li><p>快重传和快恢复</p><ul><li><p>当发送方接收到冗余ACK时，采用快重传和快恢复算法</p></li><li><p>快重传</p><ul><li>当发送方连续收到 3 个重复的ACK报文时，直接立刻重传丢失报文段，不用等待重传计时器超时</li></ul></li><li><p>快恢复</p><ul><li><p>与慢开始不同之处在于，当发送方收到 3 个冗余ACK时，它把cwnd值设置为慢开始门限ssthresh改变后的数值</p></li><li><p>快恢复算法的实现过程示例图</p><ul><li></li></ul></li></ul></li></ul></li></ul></li></ul><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/googtech/note/edit/master/docs/computer-network/chapter05.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">2021/9/29 上午6:38:06</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: hi@goog.tech">googtech</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/note/computer-network/chapter04.html" class="nav-link" aria-label="网络层"><!--[--><!--]--> 网络层 <!--[--><!--]--></a></span><span class="next"><a href="/note/computer-network/chapter06.html" class="nav-link" aria-label="应用层"><!--[--><!--]--> 应用层 <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/note/assets/js/runtime~app.cc6e98cd.js" defer></script><script src="/note/assets/js/873.a7dae0f7.js" defer></script><script src="/note/assets/js/app.2efb65c3.js" defer></script>
  </body>
</html>
